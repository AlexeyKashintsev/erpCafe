Select org_session_id, q.user_name, trade_point, q.revision, start_date, end_date
, sum(Case  When t.operation_type = 0 Then t.operation_sum Else 0 End) AS recieved_cash
, sum(Case  When t.operation_type = 1 Then t.operation_sum else 0 End) AS recieved_bonuses
, sum(Case  When t.operation_type = 10 Then t.operation_sum else 0 End) AS recieved_by_card
, count(*) as operations_count
From #qSessionsInPeriod q
 Left Join trade_cash_box_operation t on q.org_session_id = t.session_id
 Group by org_session_id, q.user_name, trade_point, start_date, end_date